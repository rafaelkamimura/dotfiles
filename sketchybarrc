#!/bin/bash

# Enhanced Felix-inspired SketchyBar config
PLUGIN_DIR="$HOME/.config/sketchybar/plugins"

# Enhanced Catppuccin Mocha palette
export BLACK=0xff181926
export WHITE=0xffcdd6f4
export RED=0xfff38ba8
export GREEN=0xffa6e3a1
export BLUE=0xff89b4fa
export YELLOW=0xfff9e2af
export ORANGE=0xfffab387
export MAGENTA=0xffcba6f7
export GREY=0xff6c7086
export SURFACE0=0xff313244
export SURFACE1=0xff45475a
export SURFACE2=0xff585b70
export TRANSPARENT=0x00000000

# Enhanced Bar Appearance
export BAR_COLOR=0xdd11111b
export ITEM_BG_COLOR=0xff313244
export ACCENT_COLOR=$BLUE
export HOVER_COLOR=0xff45475a

# Premium bar properties with advanced visual effects
sketchybar --bar height=36        \
                 blur_radius=50   \
                 position=top     \
                 sticky=on        \
                 padding_left=16  \
                 padding_right=16 \
                 color=$BAR_COLOR \
                 border_width=1   \
                 border_color=$SURFACE2 \
                 corner_radius=18 \
                 margin=6         \
                 y_offset=6       \
                 shadow=on        \
                 topmost=window_above \
                 notch_width=200  \
                 display=main

# Premium default item properties with enhanced depth
sketchybar --default updates=when_shown                              \
                     icon.font="sketchybar-app-font:Regular:16.0"   \
                     icon.color=$WHITE                               \
                     icon.padding_left=8                             \
                     icon.padding_right=8                            \
                     label.font="SF Pro:Semibold:13.0"              \
                     label.color=$WHITE                              \
                     label.padding_left=8                            \
                     label.padding_right=8                           \
                     padding_left=8                                  \
                     padding_right=8                                 \
                     background.height=30                            \
                     background.corner_radius=10                     \
                     background.color=$ITEM_BG_COLOR                 \
                     background.border_width=1                       \
                     background.border_color=$SURFACE1               \
                     background.shadow.drawing=on                    \
                     background.shadow.color=0x40000000              \
                     background.shadow.angle=270                     \
                     background.shadow.distance=2                    \
                     popup.background.border_width=1                 \
                     popup.background.corner_radius=12               \
                     popup.background.border_color=$SURFACE2         \
                     popup.background.color=$ITEM_BG_COLOR           \
                     popup.background.shadow.drawing=on              \
                     popup.background.shadow.color=0x80000000        \
                     popup.background.shadow.angle=270               \
                     popup.background.shadow.distance=8

# Left side - Apple logo with popup menu
sketchybar --add item apple.logo left                               \
           --set apple.logo icon="‚åò"                                \
                            icon.font="SF Pro:Black:20.0"           \
                            icon.color=$BLUE                        \
                            label.drawing=off                       \
                            background.drawing=on                   \
                            background.color=$ITEM_BG_COLOR         \
                            background.corner_radius=12             \
                            background.border_width=1               \
                            background.border_color=$SURFACE1       \
                            background.shadow.drawing=on            \
                            background.shadow.color=0x4089b4fa      \
                            background.shadow.angle=270             \
                            background.shadow.distance=3            \
                            padding_left=12                         \
                            padding_right=12                        \
                            click_script="$PLUGIN_DIR/apple.sh"     \
                            script="$PLUGIN_DIR/apple_hover.sh"    \
                            popup.background.color=$ITEM_BG_COLOR   \
           --subscribe apple.logo mouse.clicked mouse.entered mouse.exited

# Apple menu items
sketchybar --add item apple.about popup.apple.logo                  \
           --set apple.about icon="‚ÑπÔ∏è"                               \
                             label="About This Mac"                 \
                             click_script="system_profiler SPSoftwareDataType | head -10 | osascript -e 'display dialog (do shell script \"cat\") with title \"About This Mac\"'"

sketchybar --add item apple.activity popup.apple.logo               \
           --set apple.activity icon="üìä"                           \
                                label="Activity Monitor"            \
                                click_script="open -a 'Activity Monitor'; sketchybar --set apple.logo popup.drawing=off"

sketchybar --add item apple.preferences popup.apple.logo            \
           --set apple.preferences icon="‚öôÔ∏è"                         \
                                   label="System Preferences"       \
                                   click_script="open -a 'System Preferences'; sketchybar --set apple.logo popup.drawing=off"

sketchybar --add item apple.separator1 popup.apple.logo             \
           --set apple.separator1 icon="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"           \
                                  label.drawing=off                 \
                                  background.drawing=off

sketchybar --add item apple.sleep popup.apple.logo                  \
           --set apple.sleep icon="üò¥"                               \
                             label="Sleep"                          \
                             click_script="pmset sleepnow; sketchybar --set apple.logo popup.drawing=off"

sketchybar --add item apple.lock popup.apple.logo                   \
           --set apple.lock icon="üîí"                                \
                            label="Lock Screen"                     \
                            click_script="/System/Library/CoreServices/Menu\\ Extras/User.menu/Contents/Resources/CGSession -suspend; sketchybar --set apple.logo popup.drawing=off"

sketchybar --add item apple.separator2 popup.apple.logo             \
           --set apple.separator2 icon="‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ"           \
                                  label.drawing=off                 \
                                  background.drawing=off

sketchybar --add item apple.restart popup.apple.logo                \
           --set apple.restart icon="üîÑ"                             \
                               label="Restart"                      \
                               click_script="osascript -e 'tell app \"System Events\" to restart'; sketchybar --set apple.logo popup.drawing=off"

sketchybar --add item apple.shutdown popup.apple.logo               \
           --set apple.shutdown icon="‚èª"                             \
                                label="Shut Down"                   \
                                click_script="osascript -e 'tell app \"System Events\" to shut down'; sketchybar --set apple.logo popup.drawing=off"

# Left side - Spaces with generous horizontal spacing
SPACE_SIDS=(1 2 3 4 5 6 7 8 9 10)
for sid in "${SPACE_SIDS[@]}"
do
  sketchybar --add space space.$sid left                                    \
             --set space.$sid space=$sid                                     \
                              icon=$sid                                      \
                              icon.font="SF Pro:Bold:14.0"                  \
                              icon.padding_left=12                           \
                              icon.padding_right=6                           \
                              label.font="sketchybar-app-font:Regular:14.0" \
                              label.padding_left=6                           \
                              label.padding_right=12                         \
                              label.y_offset=-1                              \
                              padding_left=10                                \
                              padding_right=10                               \
                              background.drawing=on                          \
                              background.height=30                           \
                              background.corner_radius=10                    \
                              background.color=0xff313244                    \
                              background.border_width=1                      \
                              background.border_color=0xff45475a             \
                              script="$PLUGIN_DIR/space.sh"                  \
             --subscribe space.$sid mouse.clicked mouse.entered mouse.exited
done

# Add generous spacing between workspaces and other elements
sketchybar --add item spaces_padding left                               \
           --set spaces_padding icon=""                                  \
                                label=""                                 \
                                width=25                                 \
                                background.drawing=off

sketchybar --add item space_separator left                          \
           --set space_separator icon="‚ùØ"                           \
                                 icon.font="SF Pro:Heavy:16.0"      \
                                 icon.color=$WHITE                  \
                                 label.drawing=off                  \
                                 associated_display=active          \
                                 click_script="$PLUGIN_DIR/yabai.sh create_space" \
                                 padding_left=10                    \
                                 padding_right=10

# Left side - Front App
sketchybar --add item front_app left                                \
           --set front_app    icon.font="sketchybar-app-font:Regular:16.0" \
                              icon.color=$WHITE                     \
                              label.color=$WHITE                    \
                              background.drawing=on                 \
                              padding_left=10                       \
                              script="$PLUGIN_DIR/front_app.sh"     \
           --subscribe front_app front_app_switched

# Center - Media
sketchybar --add item media center                                  \
           --set media label.color=$WHITE                           \
                       label.max_chars=20                           \
                       icon.padding_left=0                          \
                       scroll_texts=on                              \
                       icon=                                       \
                       icon.color=$GREEN                            \
                       background.drawing=on                        \
                       script="$PLUGIN_DIR/media.sh"               \
           --subscribe media media_change

# ===== NEXT-LEVEL RIGHT SIDE DESIGN =====

# Weather group (leftmost) - Dynamic colors based on conditions
sketchybar --add bracket weather_group weather_info                 \
           --set weather_group background.drawing=on                \
                               background.color=0xff6c7086          \
                               background.corner_radius=20          \
                               background.border_width=2            \
                               background.border_color=0xffa6e3a1   \
                               background.shadow.drawing=on         \
                               background.shadow.color=0x80a6e3a1   \
                               background.shadow.angle=270          \
                               background.shadow.distance=8         \
                               script="$PLUGIN_DIR/weather_hover.sh" \
           --subscribe weather_group mouse.entered mouse.exited

sketchybar --add item weather_info right                            \
           --set weather_info script="$PLUGIN_DIR/weather_enhanced.sh" \
                              update_freq=1800                      \
                              icon.font="SF Pro:Bold:16.0"          \
                              icon.color=0xffffffff                 \
                              label.font="SF Pro:Bold:11.0"         \
                              label.color=0xffffffff                \
                              padding_left=10                       \
                              padding_right=10                      \
                              background.drawing=off                \
                              click_script="$PLUGIN_DIR/weather.sh"

# Add dramatic spacing
sketchybar --add item weather_separator right                       \
           --set weather_separator width=12 background.drawing=off

# System status group (middle) - Performance themed
sketchybar --add bracket status_group battery volume network system_stats \
           --set status_group background.drawing=on                  \
                              background.color=0xff313244            \
                              background.corner_radius=20            \
                              background.border_width=2              \
                              background.border_color=0xfff9e2af     \
                              background.shadow.drawing=on           \
                              background.shadow.color=0x80f9e2af     \
                              background.shadow.angle=270            \
                              background.shadow.distance=8           \
                              script="$PLUGIN_DIR/status_hover.sh"   \
           --subscribe status_group mouse.entered mouse.exited

# System stats (CPU + RAM combined)
sketchybar --add item system_stats right                            \
           --set system_stats script="$PLUGIN_DIR/system_stats.sh"  \
                              update_freq=3                          \
                              icon=""                               \
                              icon.color=$BLUE                       \
                              icon.font="SF Pro:Bold:14.0"           \
                              label.font="SF Mono:Bold:11.0"         \
                              label.color=0xffffffff                 \
                              padding_left=8                         \
                              padding_right=6                        \
                              background.drawing=off

# Network with SSID display
sketchybar --add item network right                                 \
           --set network script="$PLUGIN_DIR/network.sh"            \
                         update_freq=5                              \
                         icon.font="SF Pro:Bold:14.0"               \
                         label.font="SF Pro:Semibold:11.0"          \
                         label.color=0xffffffff                     \
                         padding_left=6                             \
                         padding_right=6                            \
                         background.drawing=off                     \
                         click_script="$PLUGIN_DIR/network.sh"      \
           --subscribe network mouse.clicked wifi_change

# Volume with percentage display
sketchybar --add item volume right                                  \
           --set volume script="$PLUGIN_DIR/volume.sh"              \
                        click_script="$PLUGIN_DIR/volume_click.sh"  \
                        icon.font="SF Pro:Bold:14.0"               \
                        label.font="SF Pro:Semibold:11.0"          \
                        label.color=0xffffffff                     \
                        padding_left=6                             \
                        padding_right=6                            \
                        background.drawing=off                     \
           --subscribe volume volume_change

# Battery with percentage
sketchybar --add item battery right                                 \
           --set battery script="$PLUGIN_DIR/battery.sh"            \
                         update_freq=120                            \
                         icon.font="SF Pro:Bold:14.0"               \
                         label.font="SF Pro:Semibold:11.0"          \
                         label.color=0xffffffff                     \
                         padding_left=6                             \
                         padding_right=8                            \
                         background.drawing=off                     \
           --subscribe battery system_woke power_source_change

# Add dramatic spacing
sketchybar --add item main_separator right                          \
           --set main_separator width=12 background.drawing=off

# Time & Date group (rightmost) - Premium blue with pulsing effect
sketchybar --add bracket time_group clock calendar                  \
           --set time_group background.drawing=on                   \
                            background.color=0xff89b4fa             \
                            background.corner_radius=20             \
                            background.border_width=3               \
                            background.border_color=0xff74c7ec      \
                            background.shadow.drawing=on            \
                            background.shadow.color=0xaa89b4fa      \
                            background.shadow.angle=270             \
                            background.shadow.distance=10           \
                            script="$PLUGIN_DIR/time_hover.sh"      \
           --subscribe time_group mouse.entered mouse.exited system_woke

# Calendar with enhanced date display
sketchybar --add item calendar right                                \
           --set calendar script="$PLUGIN_DIR/calendar.sh"          \
                          update_freq=300                           \
                          icon=""                                  \
                          icon.color=0xffffffff                     \
                          icon.font="SF Pro:Bold:14.0"              \
                          label.font="SF Pro:Bold:11.0"             \
                          label.color=0xffffffff                    \
                          padding_left=8                            \
                          padding_right=4                           \
                          background.drawing=off                    \
                          click_script="open -a Calendar"           \
           --subscribe calendar mouse.entered mouse.exited

# Clock with enhanced time display
sketchybar --add item clock right                                   \
           --set clock   update_freq=10                             \
                         icon=""                                   \
                         icon.color=0xffffffff                      \
                         icon.font="SF Pro:Bold:14.0"               \
                         label.color=0xffffffff                     \
                         label.font="SF Pro:Bold:12.0"              \
                         padding_left=4                             \
                         padding_right=8                            \
                         background.drawing=off                     \
                         script="$PLUGIN_DIR/clock.sh"              \
                         click_script="$PLUGIN_DIR/zen.sh"          \
           --subscribe clock mouse.entered mouse.exited

# Finalizing the setup
sketchybar --update